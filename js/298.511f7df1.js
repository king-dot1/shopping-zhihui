"use strict";(self["webpackChunkshopping"]=self["webpackChunkshopping"]||[]).push([[298],{5298:function(t,s,a){a.r(s),a.d(s,{default:function(){return h}});a(4114);var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"prodetail"},[s("van-nav-bar",{attrs:{title:"商品详情页",fixed:"","left-arrow":""},on:{"click-left":function(s){return t.$router.go(-1)}}}),s("van-swipe",{on:{change:t.onChange},scopedSlots:t._u([{key:"indicator",fn:function(){return[s("div",{staticClass:"custom-indicator"},[t._v(t._s(t.current+1)+" / "+t._s(t.count))])]},proxy:!0}])},t._l(t.detail.goods_images,(function(t,a){return s("van-swipe-item",{key:a},[s("img",{attrs:{src:t.preview_url}})])})),1),s("div",{staticClass:"info"},[s("div",{staticClass:"price-volume"},[s("div",{staticClass:"price"},[s("span",{staticClass:"new"},[t._v("￥"+t._s(t.detail.goods_price_max))]),s("span",{staticClass:"old"},[t._v("￥"+t._s(t.detail.goods_price_min))])]),s("div",{staticClass:"sales"},[t._v("已售"+t._s(t.detail.goods_sales)+"件")])]),s("div",{staticClass:"title text-ellipsis-2"},[t._v(" "+t._s(t.detail.goods_name)+" ")]),s("div",{staticClass:"guarantee"},[s("div",{staticClass:"left-words"},[s("span",[s("van-icon",{attrs:{color:"#fa2209",name:"certificate"}}),t._v(" 七天无理由退货 ")],1),s("span",[s("van-icon",{attrs:{color:"#fa2209",name:"certificate"}}),t._v(" 48小时发货 ")],1)]),s("div",{staticClass:"right-arrow"},[s("van-icon",{attrs:{name:"arrow"}})],1)])]),s("div",{staticClass:"comment"},[s("div",{staticClass:"comment-title"},[s("div",{staticClass:"left"},[t._v(" 商品评价 ("+t._s(t.commentCount)+"条) ")]),s("div",{staticClass:"right"},[t._v(" 查看更多 "),s("van-icon",{attrs:{name:"arrow"}})],1)]),s("div",{staticClass:"comment-list"},t._l(t.commentList,(function(a,i){return s("div",{key:i,staticClass:"comment-item"},[s("div",{staticClass:"top"},[s("img",{attrs:{src:a.user.avatar_url||t.defaultAvatar,alt:""}}),s("div",{staticClass:"name"},[t._v(t._s(a.user.nick_name))]),s("van-rate",{attrs:{value:a.score/2,color:"#ffd21e","void-icon":"star","void-color":"#eee"}})],1),s("div",{staticClass:"content"},[t._v(t._s(a.content))]),s("div",{staticClass:"time"},[t._v(t._s(a.create_time))])])})),0)]),s("div",{staticClass:"introduce",domProps:{innerHTML:t._s(t.detail.content)}}),s("div",{staticClass:"floor"},[s("div",{staticClass:"icon-o icon-home",on:{click:function(s){return t.$router.push("/")}}},[s("van-icon",{attrs:{name:"wap-home-o"}}),s("span",[t._v("首页")])],1),s("div",{staticClass:"icon-o icon-cart",on:{click:function(s){return t.$router.push("/cart")}}},[s("van-icon",{attrs:{name:"shopping-cart-o"}}),s("span",[t._v("购物车")]),t.cartTotal>0?s("span",{staticClass:"num"},[t._v(t._s(t.cartTotal>99?"99+":t.cartTotal))]):t._e()],1),s("div",{staticClass:"bnt bnt-add",on:{click:function(s){return t.showActionSheet("cart")}}},[t._v("加入购物车")]),s("div",{staticClass:"bnt bnt-buy",on:{click:function(s){return t.showActionSheet("buyNow")}}},[t._v("立即购买")])]),s("van-action-sheet",{attrs:{title:"cart"===t.mode?"加入购物车":"立即购买"},model:{value:t.isShow,callback:function(s){t.isShow=s},expression:"isShow"}},[s("div",{staticClass:"content"},[s("div",{staticClass:"title"},[s("div",{staticClass:"left"},[s("img",{attrs:{src:t.detail.goods_image,alt:""}})]),s("div",{staticClass:"right"},[s("div",{staticClass:"price"},[s("span",[t._v("￥")]),s("span",{staticClass:"new-price"},[t._v(t._s(t.detail.goods_price_max))])]),s("div",{staticClass:"stock"},[s("span",[t._v("库存 ")]),s("span",{staticClass:"stock-total"},[t._v(t._s(t.detail.stock_total))])])])]),s("div",{staticClass:"num-box"},[s("span",[t._v("数量")]),s("NumberBox",{model:{value:t.value,callback:function(s){t.value=s},expression:"value"}})],1),s("div",{staticClass:"btn-box"},[s("div",{staticClass:"btn",class:{buyNow:"buyNow"===t.mode},on:{click:t.addBuy}},[t._v(" "+t._s("cart"===t.mode?"加入购物车":"立即购买")+" ")])])])])],1)},o=[],e=a(9652),n=a(6792),c=a(7767),r=a(5485),l={methods:{loginConfirm(){return!this.token&&(this.$dialog.confirm({title:"温馨提示",message:"此时需要先登录才能继续操作哦!",confirmButtonText:"去登录",confirmButtonColor:"#ee0a24",cancelButtonText:"再逛逛"}).then((()=>{const t="/detail/"+this.goodsId;this.$router.replace(`/login?backUrl=${t}`)})).catch((()=>{})),!0)}}},d={name:"ProDetailIndex",mixins:[l],components:{NumberBox:n.A},data(){return{value:1,mode:"cart",isShow:!1,current:0,detail:{},count:0,limit:5,commentList:[],defaultAvatar:c,commentCount:0,cartTotal:this.$store.state.cart.cartTotal}},created(){this.getDtail(),this.getComment(),this.getCommentCount()},computed:{goodsId(){return this.$route.params.id},token(){return this.$store.getters.token}},methods:{async addBuy(){if(this.loginConfirm())return;const t=this.detail.skuList[0].goods_sku_id;if("cart"===this.mode){const{data:{cartTotal:s}}=await(0,e.U4)(this.goodsId,this.value,t);this.cartTotal=s,this.$store.dispatch("cart/setCartTotalActions"),this.isShow=!1}else this.$router.push({path:"/pay",query:{mode:"buyNow",goodsId:this.goodsId,goodsNum:this.value,goodsSkuId:t}})},showActionSheet(t){this.mode=t,this.isShow=!0},onChange(t){this.current=t},async getDtail(){const{data:{detail:t}}=await(0,r._P)(this.goodsId);this.detail=t,this.count=t.goods_images.length},async getComment(){const{data:{list:t}}=await(0,r.Ck)(this.goodsId,this.limit);this.commentList=t},async getCommentCount(){const{data:{total:t}}=await(0,r.L)(this.goodsId);this.commentCount=t.all}}},u=d,m=a(1656),v=(0,m.A)(u,i,o,!1,null,"388f00bd",null),h=v.exports},5485:function(t,s,a){a.d(s,{Ck:function(){return n},F5:function(){return o},L:function(){return c},_P:function(){return e}});var i=a(5720);const o=t=>{const{sortType:s,sortPrice:a,categoryId:o,goodsName:e,page:n}=t;return i.A.get("/goods/list",{params:{sortType:s,sortPrice:a,categoryId:o,goodsName:e,page:n}})},e=t=>i.A.get("/goods/detail",{params:{goodsId:t}}),n=(t,s)=>i.A.get("/comment/listRows",{params:{goodsId:t,limit:s}}),c=t=>i.A.get("/comment/total",{params:{goodsId:t}})}}]);
//# sourceMappingURL=298.511f7df1.js.map