"use strict";(self["webpackChunkshopping"]=self["webpackChunkshopping"]||[]).push([[124],{2776:function(e,t,a){a.d(t,{Bf:function(){return n},Re:function(){return r},Wd:function(){return s},Z8:function(){return c},aX:function(){return u},h5:function(){return l},p1:function(){return d},y9:function(){return o}});var i=a(5720);const n=()=>i.A.get("/region/tree"),r=()=>i.A.get("/address/list"),s=(e,t,a,n)=>i.A.post("/address/add",{form:{name:e,phone:t,region:a,detail:n}}),o=e=>i.A.get("/address/detail",{params:{addressId:e}}),l=(e,t)=>{const{name:a,phone:n,region:r,detail:s}=t;return i.A.post("/address/edit",{addressId:e,form:{name:a,phone:n,region:r,detail:s}})},d=e=>{i.A.post("/address/remove",{addressId:e})},c=()=>i.A.get("/address/defaultId"),u=e=>{i.A.post("/address/setDefault",{addressId:e})}},5124:function(e,t,a){a.r(t),a.d(t,{default:function(){return u}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"create"},[t("van-nav-bar",{attrs:{title:"编辑收货地址","left-arrow":""},on:{"click-left":function(t){return e.$router.go(-1)}}}),t("div",{staticClass:"title"},[e._v("收货地址")]),t("van-form",{ref:"formInfo",attrs:{"validate-first":""},on:{submit:e.onSubmit,failed:e.onFailed}},[t("van-field",{staticClass:"field1",attrs:{label:"姓名",name:"name",placeholder:"请输入收货人姓名",rules:e.formRyles.name},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),t("van-field",{attrs:{label:"电话",name:"mobile",placeholder:"请输入收货人手机号",rules:e.formRyles.mobile},model:{value:e.mobile,callback:function(t){e.mobile=t},expression:"mobile"}}),t("van-field",{attrs:{rules:e.formRyles.area,readonly:"",clickable:"",name:"area",value:e.area,label:"地区选择",placeholder:"请选择省/市/区"},on:{click:function(t){e.showArea=!0}}}),t("van-popup",{attrs:{position:"bottom"},model:{value:e.showArea,callback:function(t){e.showArea=t},expression:"showArea"}},[t("van-area",{attrs:{"area-list":e.areaList1,value:e.selectedAreaCode},on:{confirm:e.onConfirm,cancel:function(t){e.showArea=!1}}})],1),t("van-field",{staticClass:"field2",attrs:{label:"详细地址",name:"detail",placeholder:"街道门牌、楼层等信息",rules:e.formRyles.detail},model:{value:e.detail,callback:function(t){e.detail=t},expression:"detail"}}),t("div",{staticStyle:{margin:"16px"}},[t("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit"}},[e._v("保存")])],1)],1)],1)},n=[],r=(a(8111),a(116),a(2776)),s=a(5882),o={name:"updatePage",mixins:[s.A],data(){return{selectedAreaCode:"100000"}},async created(){try{await this.getRegionTree(),this.getRegionTreeHandler(this.$store.state.address.list),this.getAddressDetail()}catch(e){console.error(e)}},methods:{async getAddressDetail(){const{data:{detail:e}}=await(0,r.y9)(this.addressId);this.detail=e.detail,this.name=e.name,this.mobile=e.phone,this.area=e.region.province+"/"+e.region.city+"/"+e.region.region;const t=this.areaList2.find((t=>t.value===e.province_id)).children.find((t=>t.value===e.city_id)).children.find((t=>t.value===e.region_id));this.selectedAreaCode=t.code,this.region=[{value:e.province_id,label:e.region.province},{value:e.city_id,label:e.region.city},{value:e.region_id,label:e.region.region}]},async onSubmit(){await(0,r.h5)(this.addressId,{name:this.name,phone:this.mobile,region:this.region,detail:this.detail}),this.$router.go(-1)}},computed:{addressId(){return this.$route.query.addressId}}},l=o,d=a(1656),c=(0,d.A)(l,i,n,!1,null,"4cbc8231",null),u=c.exports},5882:function(e,t,a){a(8111),a(2489),a(116),a(7588),a(1701);var i=a(2776);t.A={data(){return{name:"",mobile:"",region:[],area:"",detail:"",showArea:!1,areaList1:{province_list:{},city_list:{},county_list:{}},areaList2:[],formRyles:{name:[{required:!0,message:"请输入名字"}],mobile:[{required:!0,message:"请填手机号"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确手机号"}],area:[{required:!0,message:"请选择地区"}],detail:[{required:!0,message:"请输入详细地址"}]}}},methods:{onFailed(e){this.$toast(e.errors[0].message)},onConfirm(e){const t=this.areaList2.find((t=>t.code===e[0].code)),a=t.children.find((t=>t.code===e[1].code)),i=a.children.find((t=>t.code===e[2].code));this.region=[{value:t.value,label:t.name},{value:a.value,label:a.name},{value:i.value,label:i.name}],this.area=e.filter((e=>!!e)).map((e=>e.name)).join("/"),this.showArea=!1},async getRegionTree(){const e=this.$store.state.address.list;if(Object.keys(e).length>0)return void this.getRegionTreeHandler(e);const{data:{list:t}}=await(0,i.Bf)();this.$store.commit("address/setRegionTreeMutation",t)},async getRegionTreeHandler(e){const t=Object.keys(e);t.forEach(((t,a)=>{const i=e[t],n=(10+a).toString().padEnd(6,"0");if(this.areaList1.province_list[n]=i.name,this.areaList2[a]={code:n,value:i.id,name:i.name,children:[]},i.city){const e=Object.keys(i.city);e.forEach(((e,t)=>{const n=i.city[e],r=(10+a).toString()+(t+1).toString().padStart(2,"0")+"00";if(this.areaList1.city_list[r]=n.name,this.areaList2[a].children[t]={code:r,value:n.id,name:n.name,children:[]},n.region){const e=Object.keys(n.region);e.forEach(((e,i)=>{const r=n.region[e],s=(10+a).toString()+(t+1).toString().padStart(2,"0")+(i+1).toString().padStart(2,"0");this.areaList1.county_list[s]=r.name,this.areaList2[a].children[t].children[i]={code:s,value:r.id,name:r.name}}))}}))}}))}}}}}]);
//# sourceMappingURL=124.d206f35a.js.map